{"ast":null,"code":"'use strict';\n\nvar refractorScheme = require('./scheme.js');\n\nmodule.exports = racket;\nracket.displayName = 'racket';\nracket.aliases = ['rkt'];\n\nfunction racket(Prism) {\n  Prism.register(refractorScheme);\n  Prism.languages.racket = Prism.languages.extend('scheme', {\n    'lambda-parameter': {\n      // the racket lambda syntax is a lot more complex, so we won't even attempt to capture it.\n      // this will just prevent false positives of the `function` pattern\n      pattern: /(\\(lambda\\s+\\()[^()'\\s]+/,\n      lookbehind: true\n    }\n  }); // Add brackets to racket\n  // The basic idea here is to go through all pattens of Scheme and replace all occurrences of \"(\" with the union of \"(\"\n  // and \"[\"; Similar for \")\". This is a bit tricky because \"(\" can be escaped or inside a character set. Both cases\n  // have to be handled differently and, of course, we don't want to destroy groups, so we can only replace literal \"(\"\n  // and \")\".\n  // To do this, we use a regular expression which will parse any JS regular expression. It works because regexes are\n  // matches from left to right and already matched text cannot be matched again. We use this to first capture all\n  // escaped characters (not really, we don't get escape sequences but we don't need them). Because we already captured\n  // all escaped characters, we know that any \"[\" character is the start of a character set, so we match that character\n  // set whole.\n  // With the regex parsed, we only have to replace all escaped \"(\" (they cannot be unescaped outside of character sets)\n  // with /[([]/ and replace all \"(\" inside character sets.\n  // Note: This method does not work for \"(\" that are escaped like this /\\x28/ or this /\\u0028/.\n\n  Prism.languages.DFS(Prism.languages.racket, function (key, value) {\n    if (Prism.util.type(value) === 'RegExp') {\n      var source = value.source.replace(/\\\\(.)|\\[\\^?((?:\\\\.|[^\\\\\\]])*)\\]/g, function (m, g1, g2) {\n        if (g1) {\n          if (g1 === '(') {\n            // replace all '(' characters outside character sets\n            return '[([]';\n          }\n\n          if (g1 === ')') {\n            // replace all ')' characters outside character sets\n            return '[)\\\\]]';\n          }\n        }\n\n        if (g2) {\n          var prefix = m[1] === '^' ? '[^' : '[';\n          return prefix + g2.replace(/\\\\(.)|[()]/g, function (m, g1) {\n            if (m === '(' || g1 === '(') {\n              // replace all '(' characters inside character sets\n              return '([';\n            }\n\n            if (m === ')' || g1 === ')') {\n              // replace all ')' characters inside character sets\n              return ')\\\\]';\n            }\n\n            return m;\n          }) + ']';\n        }\n\n        return m;\n      });\n      this[key] = RegExp(source, value.flags);\n    }\n  });\n  Prism.languages.insertBefore('racket', 'string', {\n    lang: {\n      pattern: /^#lang.+/m,\n      greedy: true,\n      alias: 'keyword'\n    }\n  });\n  Prism.languages.rkt = Prism.languages.racket;\n}","map":null,"metadata":{},"sourceType":"script"}